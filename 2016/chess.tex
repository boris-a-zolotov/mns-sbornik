\task{Фигуры в шахматах}
\begin{itemize}
\itA Для определенности будем учитывать в общем количестве пройденных клеток начальные и конечные клетки.

Ферзь путешествует с поля $(a,b)$ на поле $(c,d)$. Рассмотрим разницу начальных и конечных координат. 
Пусть для определенности разница в номере колонки не меньше, чем в номере строки ($|a-c| \ge |b-d|$).
Поскольку ферзь не прыгает через клетки, он должен пройти не меньше $|a-c|+1$ клетки (иначе окажется,
что через какую-то вертикаль из находящихся между $a$ и $c$ он перепрыгнет, не побывав на ней).

Однако, если ферзь пройдет по диагонали $|b-d|+1$ клеток, и оставшиеся $|a-c|-|b-d|$ клеток пройдет
по горизонтали, то посетит в точности $|a-c|+1$ клетку. 
Поэтому ответ на задачу --- максимум разниц координат плюс один: $\max(|a-c|,|b-d|)+1$.

Ниже на картинке показан пример движения ферзя с поля {\bfseries b3} на поле {\bfseries d7}. 
Ферзь посетит на своем маршруте $\max(|2-4|,|3-7|)+1 = 5$ клеток.

\begin{center}\tikz[x=6mm,y=6mm]{
    \draw[fill=black!20,even odd rule] (0,0) 
    foreach \n in {1,2,3,4} { -- ++ (8,0) -- ++ (0,1) -- ++ (-8,0) -- ++ (0,1) } -- (8,8)
    foreach \n in {1,2,3,4} { -- ++ (0,-8) -- ++ (-1,0) -- ++ (0,8) -- ++ (-1,0) } -- cycle
    foreach[count=\n] \m in {a,b,...,h} { (-0.4,\n-0.5) node {\n} (\n-0.5,-0.5) node {\phantom{g}\m\phantom{f}} }; 

    \draw[very thick,->,>=stealth] (1.5,2.5)  -- (3.5,4.5) -- (3.5,6.5); 
}\end{center}

\itB Корблюд имеет четыре возможных хода, которые в процессе перемещения можно повторять сколько угодно
раз. Давайте укажем для каждого хода Корблюда его \emph{сдвиг} --- координаты поля, в котором 
Корблюд окажется после хода, если изначально он стоит на поле $(0,0)$:

\begin{center}\begin{tabular}{lll}
Текстовое описание хода & Сдвиг\\
\hline                       
вправо и вверх & $(1,3)$  \\
вправо и вниз & $(1,-3)$  \\
влево и вниз & $(-1,-2)$  \\
влево и вверх & $(-1,2)$  \\
\end{tabular}\end{center}

Несложно понять, что порядок ходов значения не имеет, и для итогового перемещения 
важно только количество ходов каждого типа.

Давайте введем обозначения для количества ходов Корблюда каждого типа 
($n_\nearrow$, $n_\searrow$, $n_\swarrow$ и $n_\nwarrow$) и
составим уравнение: Корблюд может
сдвинуться на $(p,q)$ клеток, если уравнение
$n_\nearrow(1,3) + n_\searrow(1,-3) + n_\swarrow(-1,-2) + n_\nwarrow(-1,2) = (p,q)$
имеет решение.

Подберем коэффициенты, позволяющие получить все возможные единичные сдвиги $(0,1)$,
$(0,-1)$, $(1,0)$ и $(-1,0)$, это легко сделать простым перебором ходов:

\begin{center}\begin{tabular}{lllll}
Сдвиг & $n_\nearrow$ & $n_\searrow$ & $n_\swarrow$ & $n_\nwarrow$ \\
\hline
$(1,0)$  & 3 & 1 & 3 & 0\\
$(-1,0)$ & 1 & 3 & 0 & 3\\
$(0,1)$  & 1 & 0 & 1 & 0\\
$(0,-1)$ & 0 & 1 & 0 & 1
\end{tabular}\end{center}

Каким бы ни было перемещение, его можно всегда представить как комбинацию единичных сдвигов,
которые, в свою очередь, можно представить как комбинацию ходов Корблюда. Значит, Корблюд может 
достигнуть любой клетки доски из любой.

Для решения второй части задачи выпишем сдвиги для ходов Корблюда Диагонального и попробуем,
например, получить единичный сдвиг вверх, найдя решения уравнения:
$$n_\nearrow(1,3) + n_\searrow(1,-2) + n_\swarrow(-1,-3) + n_\nwarrow(-1,2) = (0,1)$$

Преобразуем уравнение для координат в систему уравнений:
$$\left\{\begin{array}{l}
  (n_\nearrow - n_\swarrow) + (n_\searrow - n_\nwarrow) = 0\\
  3\cdot(n_\nearrow- n_\swarrow) - 2\cdot(n_\searrow-n_\nwarrow)=1
\end{array}\right.$$

Заменим $n_\nearrow- n_\swarrow$ на $x$ и $n_\searrow-n_\nwarrow$ на $y$:
$$\left\{\begin{array}{l}
  x + y = 0\\
  3x - 2y=1
\end{array}\right.$$

То есть $x = -y$, отсюда $5x = 1$, а это уравнение не имеет решений в целых числах
(мы должны сделать на $0.2$ хода больше вправо и вверх, чем влево и вниз).
Значит, и исходное уравнение не имеет решений, а потому и Корблюд Диагональный
не сможет обойти всю доску.

Заметим, что если рассмотреть перемещение вверх на кратное 5 число клеток, то 
уравнение станет разрешимым ($5x = 5$, $x=1$, $y=-1$). Это возможно, например,
при $n_\nearrow = n_\nwarrow = 1$ и $n_\swarrow = n_\searrow = 0$: идем вправо и вверх,
после чего влево и вверх. Но это будет решением уже какой-то другой задачи.

\itC Пусть нам дана фигура, имеющая четыре возможных хода. Выпишем эти ходы
в порядке обхода по часовой стрелке, начиная с верхнего правого угла:
$(1,a),(1,-b),(-1,-c),(-1,d)$, где $a$,$b$,$c$ и $d$ могут быть равны 2 или 3. 
Например, для Корблюда из пункта {\bfseries B} это будет $(1,3),(1,-3),(-1,-2),(-1,2)$.
Выпишем вертикальные сдвиги фигуры в строку (назовем эту строку \emph{сигнатурой} фигуры):
$abcd$. Скажем, Корблюд имеет сигнатуру 3322, а Диагональный корблюд --- 3232. 
Всего таких строк 16, поэтому без учета симметрии имеется 16 возможных фигур.

Однако, с учетом симметрии некоторые фигуры мы должны отождествить: а именно, все зеркально
симметричные по горизонтали и вертикали. То есть, фигура $abcd$, отраженная по горизонтали --- 
это $badc$, отраженная по вертикали --- это $dcba$, отраженная и по горизонтали и по 
вертикали (центральная симметрия) --- $cdab$.

С учетом этого подсчитаем количество фигур, сгруппировав их по количеству троек в сигнатурах
и указав симметричные варианты для фигуры, если такие фигуры ранее не встречались:

\begin{center}\begin{tabular}{lllll}
       &        & \multicolumn{3}{c}{симметрия}\\\cline{3-5}
тройки & фигура & гориз. & верт. & центр.\\
\hline
0 & 2222                       \\
1 & 3222 & 2322 & 2223 & 2232\\
2 & 3322 &      & 2233 & \\
  & 3232 & 2323 & & \\
  & 2332 & 3223 & & \\
3 & 3332 & 3323 & 2333 & 3233 \\
4 & 3333 & 
\end{tabular}\end{center}

Как нетрудно заметить, всего получилось 7 различных фигур, все остальные можно получить из них с помощью симметрий.

\emph{Фигуры 3322 и 3232} рассмотрены в пункте {\bfseries B}, фигура 3322 позволяет обойти все поле, а 
фигура 3232 --- нет. 

\emph{Фигура 2332.} По своей идее она подобна фигуре 3322. Фигура 2332 <<развернута>> на $90^\circ$ 
градусов относительно фигуры 3322, поэтому для нее легко получить единичные сдвиги вправо и влево, а сдвиги 
вверх и вниз получатся сложными:

\begin{center}\begin{tabular}{lllll}
Сдвиг & $n_\nearrow$ & $n_\searrow$ & $n_\nwarrow$ & $n_\swarrow$ \\
\hline
$(1,0)$ & 1 & 0 & 0 & 1\\
$(-1,0)$ & 0 & 1 & 1 & 0\\
$(0,1)$ & 3 & 1 & 0 & 3\\
$(0,-1)$ & 0 & 1 & 1 & 0
\end{tabular}\end{center}

\emph{Фигуры 2222 и 3333.} В случае фигуры 2222 перемещение по вертикали всегда кратно 2, значит, клетки с 
нечетными вертикальными координатами будут нам недоступны. Аналогично, в случае фигуры 3333 недоступны
клетки с координатами $(x,y)$, где $y$ не кратен 3.

\emph{Фигура 3222.} Единичные сдвиги $(0,1)$ и $(-1,0)$ получить легко, а вот сдвиги $(0,-1)$ и $(1,0)$ заставляют 
задуматься. Вместо того, чтобы подбирать эти решения, давайте воспользуемся <<тяжелой артиллерией>> ---
построим и решим соответствующие диофантовы уравнения.

Составим уравнение:
$n_\nearrow(1,3) + n_\searrow(1,-2) + n_\swarrow(-1,-2) + n_\nwarrow(-1,2) = (0,-1)$

Преобразуем:
$$\left\{\begin{array}{l}
  (n_\nearrow + (n_\searrow - n_\nwarrow - n_\swarrow) = 0\\
  3\cdot n_\nearrow - 2\cdot(n_\searrow - n_\nwarrow + n_\swarrow)=-1
\end{array}\right.$$

Обозначим $n_\nearrow$ за $x$ и $n_\searrow - n_\nwarrow + n_\swarrow$ за $y$.
Рассмотрим уравнение $3x - 2y = -1$, выразим $y$ из него: $y = \frac{1 + 3x}{2}$. 
Но нас устраивают не все такие $y$, а только целые. Значит, $1+3x$ должно делиться на 2, 
то есть $3x \bmod 2 = 1$. 

Легко видно, что $x=1$ удовлетворяет этому условию. Пусть еще какой-то $t$ удовлетворяет
условию $3t \bmod 2 = 1$. Тогда $3(x-t) \bmod 2 = 3x \bmod 2 - 3t \bmod 2 = 0$,
а поскольку 2 и 3 взаимнопросты, то $(x-t) \divsby 2$.
То есть, все значения, удовлетворяющие условию, строятся по правилу $x = 2k + 1$.
Отсюда $y = \frac{4 + 6k}{2} = 3k + 2$.

Второе уравнение системы разрешено, подставим значения в первое уравнение:
$(2k + 1) + (3k + 2) -2\cdot n_\swarrow = 0$. Решений у него много, давайте, например, 
возьмем $k = 1$ и $n_\swarrow=4$, и это приведет к $n_\nearrow = x = 3$, а из 
$n_\searrow - n_\nwarrow + 4 = y = 5$ можем взять $n_\searrow = 1$ и $n_\nwarrow = 0$.

%$(3,9) + (1,-2) + (-4,-8) = (0,-1)$

И последнее уравнение:
$$n_\nearrow(1,3) + n_\searrow(1,-2) + n_\swarrow(-1,-2) + n_\nwarrow(-1,2) = (1,0).$$

Здесь $3x - 2y = 0$, отчего $x = 2k$, $y = 3k$ и $2k + 3k - 2\cdot n_\swarrow = 1$ и
если выбрать $k=1$, то $n_\swarrow = 2$. Тогда $n_\nearrow = x = 2$, 
и из замены $n_\searrow - n_\nwarrow + 2 = y = 3$ выберем $n_\searrow = 1$ и $n_\nwarrow = 0$.

%$(2,6) + (1,-2) + (-2,-4) = (1,0)$

\begin{center}\begin{tabular}{lllll}
Сдвиг & $n_\nearrow$ & $n_\searrow$ & $n_\swarrow$ & $n_\nwarrow$ \\
\hline
$(1,0)$  & 2 & 1 & 2 & 0\\
$(0,-1)$ & 3 & 1 & 4 & 0\\
$(0,1)$  & 1 & 0 & 1 & 0\\
$(-1,0)$ & 2 & 0 & 0 & 3
\end{tabular}\end{center}

\emph{Фигура 3332.} Попробуем здесь еще один метод: сведем эту фигуру к фигуре 2332. 
Заметим, что $(1,3)+(1,-3)+(-1,2) = (1,2)$, то есть последовательность из трех ходов 
(вправо и вверх, вправо и вниз, влево и вверх) заменяет отсутствующий у нас ход $(1,2)$. 
Остальные же ходы у 2332 и 3332 совпадают. Значит, любое перемещение 2332 доступно и 
для 3332.

\emph{Итого:} четыре фигуры (3322, 2332, 3222 и 3332) могут обойти все поле, а три оставшиеся
(2222, 3333, 3232) не могут.

Отдельно заметим, что решение диофантовых уравнений --- важная область алгебры, и, хотя для некоторых
типов таких уравнений есть разработанные методы решения, в общем случае задача неразрешима. 
Вопрос о поиске общего метода решения был поставлен Гильбертом в 1900 году (<<10 проблема Гильберта>>), 
и в 1970 году Юрий Матиясевич показал, что такого метода нет.

\end{itemize}

%\begin{center}
%  \includegraphics[width=8.5cm]{figures/2016/corbleud.png}
%\end{center}
