\task{Через тернии к звездам}
\def\vfi{\varphi}
\def\gcd{\text{НОД}\,}

\begin{enumerate}

	\item Кратчайший путь между $A$ и $C$ проходит либо через $B$, либо не затрагивая ее. В первом случае $d\,(A,B) + d\,(B,C) = d\,(A,C)$, во втором случае $d\,(A,B) + d\,(B,C) \le d\,(A,C)$, потому что кратчайший путь между $A$ и $C$, проходящий через $B$, не может быть короче пути, кратчайшего вообще.

	\item Наибольшее возможное расстояние между вершинами $n$--угольни- ка равно $\lfloor \tfrac{n}{2} \rfloor$, все значения расстояния от 0 до этого числа достигаются. На расстоянии от данной вершины, строго меньшем, чем $\tfrac{n}{2}$, всегда находятся ровно две других.
	
	Если $n$ четное, то есть одна вершина, находящаяся от данной на расстоянии $\tfrac{n}{2}$, она же наиболее удаленная. Если $n$ нечетное, то наиболее удалены от данной две вершины, находящиеся на расстоянии $\lfloor \tfrac{n}{2} \rfloor$ от нее~— справа и слева.

	\item Пусть все стороны многоугольника, кроме одной, имеют «вес» 1, а оставшаяся~— «вес» 2. Расстояние между вершинами будем считать как сумму весов сторон, по которым проходит кратчайший путь между ними. Для такого расстояния даже выполнено неравенство треугольника, а также оно зависит от выбора «тяжелой» стороны~— то есть, будет меняться при вращении многоугольника.

	Определим
	$$\delta\,(A,B) = \begin{cases} 0, & A=B;\\ 1, & A \ne B \end{cases}$$

	Для этого расстояния также выполнено неравенство треугольника, и оно, очевидно, не получается из взятого в условии задачи умножением на число, потому что расстояния между любыми двумя не равными вершинами одинаково.

\item Докажем, что $(n,k)$--звезда состоит из одной ломаной $\Longleftrightarrow$ числа $n$ и $k$ взаимно просты. Для удобства пронумеруем вершины $n$-угольни-ка числами от $0$ до $n-1$ по часовой стрелке. Заметим, что расстояние между вершинами под номерами $a$ и $b$ равно $k$ тогда и только тогда, когда
	$$a + k \equiv b \pmod n
		\text{\quad или \quad}
		b + k \equiv a \pmod n.$$

\frame{$\vphantom{\text{H}}\Longrightarrow$} Пусть одна ломаная соединяет все вершины правильного $n$--угольника. В этой ломаной обязательно есть ребро, соединяющее вершины под номерами 0 и $k$. Ребро, следующее за этим, соединяет вершины под номерами $k$ и $2k \bmod n$. Следующее за ним идет в вершину номер $3k \bmod n$, и так далее.

	Что представляет из себя, например, число $3k \bmod n$? Это, на самом деле, разность $3k - n -\ldots-n$.

	Допустим противное --- пусть НОД чисел $n$ и $k$ не равен единице. Тогда все числа вида $i \cdot k \bmod n$ будут делиться на этот НОД. Это значит, что последовательность ребер, которую мы начали, выходя из нулевой вершины, не посетит вершину №\,1. Противоречие.
	
\frame{$\vphantom{\text{H}}\Longleftarrow$} Пусть $\text{НОД}\,(n,k) = 1$, но ломаная, проходящая через нулевую вершину, не покрывает всех вершин многоугольника. Тогда среди чисел $0 \cdot k$, $1 \cdot k$, $\ldots$, $(n-1) \cdot k$ (это номера вершин, через которые проходит ломаная) в силу принципа Дирихле есть два сравнимых по модулю $n$ (соответствующих одной вершине многоугольника).
\begin{align*}
	&a_1 \cdot k - a_2 \cdot k \text{ делится на } n,\quad|a_1 - a_2|<n;\\
	&(a_1 - a_2) \cdot k \text{ делится на } n;\\
	&\text{\footnotesize($k$ взаимно просто с $n$)} \\
	& a_1 - a_2 \text{ делится на } n\ \ \Rightarrow\ \ a_1-a_2=0.
\end{align*}

Получили противоречие: числа $a_1k$ и $a_2k$ не могли оказаться различными.

Доказав это утверждение, мы можем запросто ответить на вопрос задачи: звезд, состоящих из одной ломаной, ровно столько, сколько чисел $1 \le k < n$, взаимно простых с $n$ — то есть, $\vfi(n)$.

\item 
$$\gcd \ll \frac{n}{\gcd (n,k)}, \frac{k}{\gcd (n,k)} \rr = 1;$$

Поэтому звезда с такими параметрами будет состоять из одной ломаной. В свою очередь, $(n,k)$--звезда получится, если между двумя соседними вершинами этой звезды вставить еще $\gcd(n,k)-1$ вершин и скопировать звезду из одной ломаной, повернув ее на $360/k$ градусов — смотреть рисунок:

\begin{center}
	\tikz{
		\draw[very thick, rotate=-48, color={rgb:black,1.4; white,8.6}]
			(90:2cm) -- (234:2cm) -- (378:2cm)
			-- (522:2cm) -- (666:2cm) -- cycle; 
		\draw[very thick, rotate=-24, color={rgb:black,4; white,6}]
			(90:2cm) -- (234:2cm) -- (378:2cm)
			-- (522:2cm) -- (666:2cm) -- cycle; 
		\draw[very thick] (90:2cm) -- (234:2cm) -- (378:2cm)
			-- (522:2cm) -- (666:2cm) -- cycle; 
		\draw (270:2.4cm) node{\small $(15,6)$--звезда}
	}
\end{center}

Таким образом, $(n,k)$--звезда состоит из $\gcd(n,k)$ ломаных. Следствием этого пункта является то, что количество ломаных в звезде всегда делит $n$.

\item В этом пункте требуется найти количество $k$, $1 \le k < n$, таких что $\gcd(n,k) = \ell$. Оно, очевидно, равно $\vfi(\tfrac{n}{\ell})$: все такие $k$ находятся среди чисел, кратных $\ell$, и $\gcd(\tfrac{n}{\ell},\tfrac{k}{\ell}) = 1$.

\item Количество различных звезд равно $n$: есть $(n,1)$-, $(n,2)$-, $\ldots$, $(n,n)$--звезды (последнюю можно мыслить как множество несоединенных вершин, в ней будет $n$ ломаных). Все звезды бьются на группы по количеству ломаных, которое в них содержится — в группе с $\ell$ ломаными находится $\vfi(\tfrac{n}{\ell})$ звезд.

При этом, если перечислять все числа вида $\tfrac{n}{\ell}$, в этом списке появятся все возможные делители $n$. То есть,

$$n = \sum\limits_{\ell\text{ делит }n} \vfi\ll\frac{n}{\ell}\rr =
	\sum\limits_{d\text{ делит }n} d.$$

Что и требовалось доказать.

\end{enumerate}
